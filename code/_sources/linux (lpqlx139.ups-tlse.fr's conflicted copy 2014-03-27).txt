=======
Linux
=======

SSH
====

Connect through a gateway
-------------------------

.ssh/config:

.. code-block:: text

  Host target.host.domain target
    User          username_on_target
    HostName      target.host.domain
    ProxyCommand  ssh username_on_gateway@gateway.host.domain nc %h %p 


Network
=======

Change dynamically MAC address
------------------------------

.. code-block:: bash

   ifconfig eth0 down
   ifconfig eth0 hw ether 00:90:27:3b:ef:ce
   ifconfig eth0 up

Fix wireless problems when on battery
-------------------------------------

/etc/pm/power.d/wireless::

  #!/bin/sh
  /sbin/iwconfig/ wlan0 power off


GlusterFS
=========

Setup a master
---------------

* Install packages `glusterfs-common` `glusterfs-client` `glusterfs-common`
* Open firewall ports 111, 24007, 24008, 24009-(24009 + number of bricks across all volumes)
* Start the gluster daemon

.. code-block:: bash

  $ glusterd

* Create a volume on the 1st server

.. code-block:: bash

  $ gluster volume create shared_volume lpqlx139:/home/gluster
  Creation of volume shared_volume has been successful. Please start the volume to access data.

* Start the volume

.. code-block:: bash

  $ gluster volume start shared_volume
  Starting volume shared_volume has been successful

* Mount the volume

.. code-block:: bash

  $ mount -t glusterfs localhost:/shared_volum /mnt


* Check the if the volume is OK

.. code-block:: bash

  $ gluster volume info

  Volume Name: shared_volume
  Type: Distribute
  Volume ID: 4ba82dfc-781b-41b0-a201-5bdb8ce2026b
  Status: Started
  Number of Bricks: 1
  Transport-type: tcp
  Bricks:
  Brick1: lpqlx139:/home/gluster

* Allow access to the shared volume only to some machines

.. code-block:: bash

  $ gluster volume set shared_volume auth.allow 130.120.229.31
  Set volume successful


Setup a client
---------------

* Install packages `glusterfs-client` `glusterfs-common`
* Mount the volume

.. code-block:: bash

  $ mount.glusterfs lpqlx139:/home/gluster /mnt


Setup a mirrored server
-------------------------

* Declare storage pools

.. code-block:: bash

  # On lpqlx139:
  $ gluster peer probe lpqsv11
  Probe successful

  # On lpqxv11
  $ gluster peer probe lpqlx139
  Probe successful
  
* Create the volume

.. code-block:: bash

  $ gluster volume create shared_volume replica 2 transport tcp lpqlx139:/data lpqsv11:/data
  Creation of volume testvol has been successful. Please start the volume to access data.

  
GPG
===

Add to ~/.gnupg/gpg.conf::

  cipher-algo AES256

Encrypt a file::

  gpg -c ${FILE}

Decrypt a file::

  gpg ${FILE}

Decrypt a file to stdout:: 

  gpg -qd ${FILE}

  
Change keyboard layout in X
===========================

Switch between US and US_intl

.. code-block:: bash

  #!/bin/bash                                                                                                                           
  declare -A new_layout
  new_layout["us"]="us_intl"
  new_layout["us_intl"]="us"
  
  cur_layout=$(setxkbmap -query | grep layout | cut -c13-)
  setxkbmap -layout ${new_layout[$cur_layout]}


